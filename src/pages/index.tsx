
import {  ConnectButton } from '@rainbow-me/rainbowkit';
import { useAccount, useConnect, useSwitchChain } from 'wagmi';

import Head from 'next/head';

import styles from '../styles/Home.module.css';

import { useState } from 'react';

import { useApprovePointless, useBridgeFromPolygonToBase, useBridgeFromBaseToPolygon, useTotalCustomFees } from '../hooks/useBridgePointless';
import { useStorageAt } from 'wagmi';

export
  default function
  Home() {

  const [number,setNumber] = useState('');

  const [loading, setLoading] = useState(false);
  const [sourceChain, setSourceChain] = useState('');
  const [destinationChain, setDestinationChain] = useState('');
  const { isConnected } = useAccount(); // Check if wallet is connected
  //const { connector } = useConnect();

  //const { switchChain } = useSwitchChain();

  const bridgeFromPolygonToBase = useBridgeFromPolygonToBase(number);

  const bridgeFromBaseToPolygon = useBridgeFromBaseToPolygon(number);
  
  const totalCustomFees = useTotalCustomFees();

  const approvePointless = useApprovePointless(number);
  
  // Options for the dropdown
  const chainOptions = ['Base', 'Polygon'];

  // Handle change for source chain
  const handleSourceChange = (e: React.ChangeEvent<any>) => {
    const selectedChain = e.target.value;
    setSourceChain(e.target.value);
    if (isConnected) {
      if(selectedChain === "Base")
      {
        //switchChain(connector,8453);
      }
      else if(selectedChain === "Polygon")
      {
        //switchChain(connector, 137);
      }
    }
  };

  // Handle change for destination chain
  const handleDestinationChange = (e: React.ChangeEvent<any>) => {
    setDestinationChain(e.target.value);
  };

  const
    handleChange = (e: React.ChangeEvent<any>) => {
      //console.log(e.target.value);
      setNumber(e.target.value);
    };



  const
    handleSubmit = async () => {
        setLoading(true);
        try {
          console.log(Number(number));
          if(number === '')
          {
            alert("please enter the amount to transfer");
          }
          if(sourceChain === '' || destinationChain === '' )
          {
            alert("please select the source and destination chains...");
          }
          else if(sourceChain === 'Base')
          {
            bridgeFromBaseToPolygon(Number(number))
          }
          else if(sourceChain === 'Polygon') 
          {
            console.log(await totalCustomFees());
            await bridgeFromPolygonToBase(Number(number));
          }
        } catch (err) {
          alert(err)
        } finally {
          setLoading(false);
        }

      };

  const
    handleApprove = async () => {
        setLoading(true);
        try {
          console.log(Number(number));
          console.log(sourceChain);
          if(sourceChain === "" || destinationChain === "")
          {
            alert("please select the source and destination chains...");
          }

          await approvePointless(Number(number));
          
        } catch (err) {
          //console.error(err);
        } finally {
          setLoading(false);
        }

      };
  return (

    <div
      className={styles.container}>

      <Head>
        <title>pointless test bridge</title>

        <meta

          content="Generated by @rainbow-me/create-rainbowkit"

          name="pointless test bridge"

        />

        <link
          href="/favicon.ico"
          rel="icon"
        />

      </Head>



      <main
        className={styles.main}>
        <ConnectButton
        />
        
        <div>

          <h1>Pointless bridge</h1>
          {sourceChain && (
                <label style={{ color: 'red' }}>
                  Please make sure you switch to {sourceChain} in your wallet.<br />
                  Ensure you have enough $pointless balance. <br />
                  Approval is required only when bridging from Polygon
                </label>
              )}
        <div>
        <label htmlFor="source-chain">Source Chain:</label>
        <select
          id="source-chain"
          value={sourceChain}
          onChange={handleSourceChange}
        >
          <option value="">Select Source Chain</option>
          {chainOptions.map((chain) => (
            <option key={chain} value={chain}>
              {chain}
            </option>
          ))}
        </select>
      </div>
      <div>
        <label htmlFor="destination-chain">Destination Chain:</label>
        <select
          id="destination-chain"
          value={destinationChain}
          onChange={handleDestinationChange}
        >
          <option value="">Select Destination Chain</option>
          {chainOptions.map((chain) => (
            <option key={chain} value={chain}>
              {chain}
            </option>
          ))}
        </select>
      </div>
          <input

            type="number"

            value={number}

            onChange={handleChange}

            placeholder="Amount to send"

          />

          {sourceChain === 'Polygon' && (
          <button
            onClick={handleApprove}
            className={styles.customButton}
            disabled={loading}>

            {loading
              ?
              'Processing...' :
              'Approve'}

          </button>)}

          <button
            onClick={handleSubmit}
            className={styles.customButton}
            disabled={loading}>

            {loading
              ?
              'Processing...' :
              'Send'}

          </button>
          
         
        </div>


      </main>



      <footer
        className={styles.footer}>

        <a
          href="https://rainbow.me"
          rel="noopener noreferrer"
          target="_blank">

          Made with ‚ù§Ô∏è by your frens at üåà

        </a>

      </footer>

    </div>

  );

};



//export default Home;
